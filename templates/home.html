{% extends "layout.html" %}

{% block content %}
<script src="{{ url_for('static', path='main.js') }}"></script>

<section id="features">
    <table class="ui grey table">
        <caption></caption>
        <thead>
            <tr>
                <th scope="col">Active</th>
                <th scope="col">Command</th>
                <th scope="col">Command Name</th>
                <th scope="col">Schedule</th>
                <th scope="col">Next Run</th>
                <th scope="col">Status</th>
                <th scope="col">Action</th>
                <th scope="col">Logs</th>
            </tr>
        </thead>
        {% for job in jobs %}
        <tr class="{{ 'disabled-job' if not job.is_active else '' }}">
            <td>
                <div class="ui toggle checkbox">
                    <input type="checkbox" class="job-toggle" data-job-id="{{ job.id }}" {{ 'checked' if job.is_active
                        else '' }}>
                    <label></label>
                </div>
            </td>
            <td>
                <div class="ui custom button">Show Command</div>
                <div class="ui custom popup">
                    <pre><code class="bash">{{ job.command }}</code></pre>
                </div>
            </td>
            <td>
                <pre>{{ job.name }}</pre>
            </td>
            <td>
                <div class="ui custom button">
                    <pre><code class="bash">{{ job.schedule }}</code></pre>
                </div>
                <div class="ui custom popup">
                    <div style="text-align: left;">
                        <strong>Cron Expression:</strong> {{ job.schedule }}<br>
                        <strong>Description:</strong> <em>{{ job.cron_description }}</em><br><br>
                        <strong>Format:</strong> minute hour day month weekday<br>
                        <strong>Next execution:</strong> {{ job.next_run }}
                    </div>
                </div>
            </td>
            <td>
                <pre><code class="bash">{{ job.is_active and job.next_run or '(désactivé)' }}</code></pre>
            </td>
            <td>
                <pre><code class="bash">{{ job.status }}</code></pre>
            </td>
            <td class="action-buttons">
                <button type="button" class="ui icon button green basic run-btn" value="{{ job.id }}" {{ 'disabled' if
                    not job.is_active else '' }} title="Exécuter maintenant">
                    <i class="play icon"></i>
                </button>
                <a href="/jobs/{{ job.id }}">
                    <button type="button" class="ui icon button blue basic" title="Modifier le job">
                        <i class="edit icon"></i>
                    </button>
                </a>
                <button type="button" class="ui icon button red basic delete-btn" value="{{ job.id }}"
                    title="Supprimer le job">
                    <i class="trash icon"></i>
                </button>
            </td>
            <td>
                <a href="/logs/{{ job.id }}">
                    <button type="button" class="ui icon button teal basic" title="Voir les logs">
                        <i class="file alternate outline icon"></i>
                    </button>
                </a>
            </td>
        </tr>
        {% endfor %}
    </table>
    <p>
        <button id="add_job" class="ui inverted green button">Add Job</button>
    </p>
</section>




<div class="ui modal">
    <em class="close icon"></em>
    <div class="header">
        Add Job
    </div>
    <div class="content">
        <form class="ui form" onsubmit="">
            <div class="field">
                <label>Command</label>
                <label for="command"></label><input type="text" name="command" placeholder="echo Hello World"
                    id="command" required>
            </div>
            <div class="field">
                <label>Command Name</label>
                <label for="command_name"></label><input type="text" name="command_name" placeholder="Command Name"
                    id="command_name">
            </div>
            <div class="field">
                <label>Schedule</label>
                <label for="schedule"></label><input type="text" name="schedule" placeholder="* * * * *" id="schedule">
            </div>
            <button id="save" type="button" class="ui blue button">Submit</button>
            <button id="cancel" type="button" class="ui button">Cancel</button>
        </form>
    </div>
</div>
{% endblock %}